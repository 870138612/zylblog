import{search as O,getStoredFields as $,autoSuggest as F,loadJSONIndex as L}from"slimsearch";import b from"@temp/search-pro/index";import{entries as z}from"vuepress-shared/client";const f=100,m=20,x=(r,s)=>{const i=r.toLowerCase(),n=s.toLowerCase(),o=[];let t=0,e=0;const c=(l,u=!1)=>{let a="";e===0?a=l.length>m?`… ${l.slice(-m)}`:l:u?a=l.length+e>f?`${l.slice(0,f-e)}… `:l:a=l.length>m?`${l.slice(0,m)} … ${l.slice(-m)}`:l,a&&o.push(a),e+=a.length,u||(o.push(["mark",s]),e+=s.length,e>=f&&o.push(" …"))};let p=i.indexOf(n,t);if(p===-1)return null;for(;p>=0;){const l=p+n.length;if(c(r.slice(t,p)),t=l,e>f)break;p=i.indexOf(n,t)}return e<f&&c(r.slice(t),!0),o},S=/[\u4e00-\u9fa5]/g,w=(r={})=>({fuzzy:.2,prefix:!0,processTerm:s=>{const i=s.match(S)||[],n=s.replace(S,"").toLowerCase();return n?[n,...i]:[...i]},...r}),C=(r,s,i={})=>{const n={};return O(s,r,w({boost:{h:2,t:1,c:4},...i})).forEach(o=>{const{id:t,terms:e,score:c}=o,p=t.includes("@"),l=t.includes("#"),[u,a]=t.split(/[#@]/),{contents:d}=n[u]??={title:"",contents:[]};if(p)d.push([{type:"customField",key:u,index:a,display:e.map(h=>o.c.map(g=>x(g,h))).flat().filter(h=>h!==null)},c]);else{const h=e.map(g=>x(o.h,g)).filter(g=>g!==null);if(h.length&&d.push([{type:l?"heading":"title",key:u,...l&&{anchor:a},display:h},c]),"t"in o)for(const g of o.t){const k=e.map(y=>x(g,y)).filter(y=>y!==null);k.length&&d.push([{type:"text",key:u,...l&&{anchor:a},display:k},c])}}}),z(n).sort(([,o],[,t])=>t.contents.reduce((e,[,c])=>e+c,0)-o.contents.reduce((e,[,c])=>e+c,0)).map(([o,{title:t,contents:e}])=>{if(!t){const c=$(s,o);c&&(t=c.h)}return{title:t,contents:e.map(([c])=>c)}})},M=(r,s,i={})=>F(s,r,w(i)).map(({suggestion:n})=>n);self.onmessage=async({data:{type:r="all",query:s,locale:i,options:n}})=>{const{default:o}=await b[i](),t=L(o,{fields:["h","t","c"],storeFields:["h","t","c"]});r==="suggest"?self.postMessage(M(s,t,n)):r==="search"?self.postMessage(C(s,t,n)):self.postMessage({suggestions:M(s,t,n),results:C(s,t,n)})};
//# sourceMappingURL=index.js.map
