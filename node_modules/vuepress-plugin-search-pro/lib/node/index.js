import{watch as K}from"chokidar";import{useSassPalettePlugin as J}from"vuepress-plugin-sass-palette";import{ensureEndingSlash as C,Logger as B,getPageExcerpt as V,fromEntries as z,isArray as W,keys as A,entries as S,checkVersion as Z,getLocales as G,addViteOptimizeDepsInclude as M,addViteSsrNoExternal as U}from"vuepress-shared/node";import{getDirname as X,path as H,colors as R,fs as O}from"@vuepress/utils";import{load as Q}from"cheerio";import{createIndex as Y,addAllAsync as ee,discard as L,addAll as te,vacuum as D}from"slimsearch";const N=X(import.meta.url),$=C(H.resolve(N,"../client/")),ae=C(H.resolve(N,"../worker/")),f="vuepress-plugin-search-pro",P=new B(f),x=e=>e.replace(/\//g,"")||"root",E=({options:e,deprecatedOption:a,newOption:i,msg:t="",scope:o=""})=>{if(a in e){if(P.warn(`${R.magenta(a)} is ${R.yellow("deprecated")}${o?` in ${o}`:""}, please use "${R.magenta(i)}" instead.${t?`
${t}`:""}`),i.includes(".")){const l=i.split(".");let n=e;l.forEach((s,c)=>{c!==l.length-1?(n[s]=n[s]||{},n=n[s]):n[s]=e[a]})}else e[i]=e[a];delete e[a]}},ie=e=>{E({options:e,deprecatedOption:"fullIndex",newOption:"indexContent"}),E({options:e,deprecatedOption:"historyCount",newOption:"resultHistoryCount"}),E({options:e,deprecatedOption:"delay",newOption:"searchDelay"})},ne=e=>{const{pages:a,pluginApi:i}=e;i.plugins.some(({name:t})=>t==="vuepress-plugin-blog2")||a.some(t=>"excerpt"in t.data)||a.forEach(t=>{t.data.excerpt=V(e,t,{excerptLength:0})})},se="h2,h3,h4,h5,h6".split(","),oe="header,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,tfoot,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,pre".split(","),re="routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),le=Q(""),j=e=>e.children.map(a=>a.type==="tag"?a.name==="a"&&a.attribs.class==="header-anchor"?"":j(a):a.type==="text"?a.data:"").join(" ").replace(/\s+/gu," ").trim(),I=(e,a=[],i=!1)=>{const{contentRendered:t,data:o,title:l}=e,n=e.key,s="excerpt"in o&&o.excerpt.length,c={id:n,h:l},u=[c];let h=s||i,d=null,p="",y=!0;const w=(r,m=!1)=>{r.type==="tag"?se.includes(r.name)?(p&&h&&(((y?c:d).t??=[]).push(p.replace(/\s+/gu," ")),p=""),y?y=!1:u.push(d),d={id:`${n}#${r.attribs.id}`,h:j(r)}):oe.includes(r.name)?(p&&h&&(((y?c:d).t??=[]).push(p.replace(/\s+/gu," ")),p=""),r.childNodes.forEach(g=>w(g,m||r.name==="pre"))):re.includes(r.name)&&r.childNodes.forEach(g=>w(g,m)):r.type==="text"?p+=m||r.data.trim()?r.data:"":s&&!i&&r.type==="comment"&&r.data.trim()==="more"&&(h=!1)},v=le.parseHTML(t),b=z(a.map(({getter:r},m)=>{const g=r(e);return W(g)?[m.toString(),g]:g?[m.toString(),[g]]:null}).filter(r=>r!==null));return!(v!=null&&v.length)&&!A(b).length?[]:(v==null||v.forEach(r=>{w(r)}),h&&p&&((y?c:d).t??=[]).push(p),d&&u.push(d),S(b).forEach(([r,m])=>{u.push({id:`${n}@${r}`,c:m})}),u)},_=async(e,{customFields:a,indexContent:i,indexOptions:t,indexLocaleOptions:o})=>{const l={};e.pages.forEach(s=>{const c=I(s,a,i);(l[s.pathLocale]??=[]).push(...c)});const n={};return await Promise.all(S(l).map(async([s,c])=>{const u=Y({...t,...o==null?void 0:o[s],fields:["h","t","c"],storeFields:["h","a","t","c"]});await ee(u,c),n[s]=u})),n},ce=async(e,a)=>{const i=e.dir.dest(a.worker||"search-pro.worker.js"),t=JSON.stringify(await _(e,a)),o=`${ae}index.js`,l=await O.readFile(o,"utf8");await O.ensureDir(H.dirname(i)),await O.writeFile(i,l.replace("SEARCH_PRO_INDEX",()=>`${JSON.stringify(t)}`))},ue={"/en/":{cancel:"Cancel",placeholder:"Search",search:"Search",searching:"Searching",defaultTitle:"Documentation",select:"to select",navigate:"to navigate",autocomplete:"to autocomplete",exit:"to exit",history:"Search History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."},"/zh/":{cancel:"取消",placeholder:"搜索",search:"搜索",searching:"搜索中",defaultTitle:"文档",select:"选择",navigate:"切换",autocomplete:"自动补全",exit:"关闭",history:"搜索历史",emptyHistory:"无搜索历史",emptyResult:"没有找到结果",loading:"正在加载搜索索引..."},"/zh-tw/":{cancel:"取消",placeholder:"搜索",search:"搜素",searching:"搜索中",defaultTitle:"文檔",select:"選擇",navigate:"切換",autocomplete:"自動補全",exit:"關閉",history:"搜索歷史",emptyHistory:"無搜索歷史",emptyResult:"沒有找到結果",loading:"正在加載搜索索引..."},"/de/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",defaultTitle:"Dokumentation",select:"auswählen",navigate:"wechseln",autocomplete:"automatisch vervollständigen",exit:"schließen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/de-at/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",defaultTitle:"Dokumentation",select:"auswählen",navigate:"wechseln",autocomplete:"automatisch vervollständigen",exit:"schließen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/vi/":{cancel:"Hủy",placeholder:"Tìm kiếm",search:"Tìm kiếm",searching:"Đang tìm kiếm",defaultTitle:"Tài liệu",select:"chọn",navigate:"chuyển",autocomplete:"tự động hoàn thành",exit:"đóng",history:"Lịch sử tìm kiếm",emptyHistory:"Xóa lịch sử tìm kiếm",emptyResult:"Không tìm thấy kết quả",loading:"Đang tải chỉ mục tìm kiếm..."},"/uk/":{cancel:"Скасувати",placeholder:"Пошук",search:"Пошук",searching:"Пошук",defaultTitle:"Документація",select:"вибрати",navigate:"перейти",autocomplete:"автозаповнення",exit:"закрити",history:"Історія пошуку",emptyHistory:"Очистити історію пошуку",emptyResult:"Нічого не знайдено",loading:"Завантаження пошукових індексів..."},"/ru/":{cancel:"Отмена",placeholder:"Поиск",search:"Поиск",searching:"Поиск",defaultTitle:"Документация",select:"выбрать",navigate:"переключить",autocomplete:"автозаполнение",exit:"закрыть",history:"История поиска",emptyHistory:"Очистить историю поиска",emptyResult:"Ничего не найдено",loading:"Загрузка поисковых индексов..."},"/br/":{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",searching:"Pesquisando",defaultTitle:"Documentação",select:"selecionar",navigate:"navegar",autocomplete:"autocompletar",exit:"fechar",history:"Histórico de pesquisa",emptyHistory:"Limpar histórico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando índices de pesquisa..."},"/pl/":{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",searching:"Szukanie",defaultTitle:"Dokumentacja",select:"wybierz",navigate:"przejdź",autocomplete:"autouzupełnianie",exit:"zamknij",history:"Historia wyszukiwania",emptyHistory:"Wyczyść historię wyszukiwania",emptyResult:"Nie znaleziono wyników",loading:"Ładowanie indeksów wyszukiwania..."},"/sk/":{cancel:"Zrušiť",placeholder:"Hľadať",search:"Hľadať",searching:"Hľadanie",defaultTitle:"Dokumentácia",select:"vybrať",navigate:"prepnúť",autocomplete:"automatické dopĺňanie",exit:"zavrieť",history:"História vyhľadávania",emptyHistory:"Vymazať históriu vyhľadávania",emptyResult:"Nenašli sa žiadne výsledky",loading:"Načítavajú sa vyhľadávacie indexy..."},"/fr/":{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",searching:"Recherche",defaultTitle:"Documentation",select:"sélectionner",navigate:"naviguer",autocomplete:"auto-complétion",exit:"fermer",history:"Historique de recherche",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun résultat trouvé",loading:"Chargement des index de recherche..."},"/es/":{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",searching:"Buscando",defaultTitle:"Documentación",select:"seleccionar",navigate:"navegar",autocomplete:"autocompletar",exit:"cerrar",history:"Historial de búsqueda",emptyHistory:"Vaciar historial de búsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando índices de búsqueda..."},"/ja/":{cancel:"キャンセル",placeholder:"検索",search:"検索",searching:"検索中",defaultTitle:"ドキュメント",select:"選択",navigate:"切り替え",autocomplete:"オートコンプリート",exit:"閉じる",history:"検索履歴",emptyHistory:"検索履歴をクリア",emptyResult:"結果が見つかりません",loading:"検索インデックスを読み込んでいます..."},"/tr/":{cancel:"İptal",placeholder:"Ara",search:"Ara",searching:"Aranıyor",defaultTitle:"Dökümantasyon",select:"seç",navigate:"geç",autocomplete:"otomatik tamamlama",exit:"kapat",history:"Arama geçmişi",emptyHistory:"Arama geçmişini temizle",emptyResult:"Sonuç bulunamadı",loading:"Arama dizinleri yükleniyor..."},"/ko/":{cancel:"취소",placeholder:"검색",search:"검색",searching:"검색 중",defaultTitle:"문서",select:"선택",navigate:"이동",autocomplete:"자동 완성",exit:"닫기",history:"검색 기록",emptyHistory:"검색 기록 지우기",emptyResult:"결과를 찾을 수 없습니다",loading:"검색 인덱스를 로드하는 중..."},"/fi/":{cancel:"Peruuta",placeholder:"Etsi",search:"Etsi",searching:"Etsitään",defaultTitle:"Dokumentaatio",select:"valitaksesi",navigate:"navigoidaksesi",autocomplete:"automaattinen täydennys",exit:"poistuaksesi",history:"Hakuhistoria",emptyHistory:"Tyhjennä hakuhistoria",emptyResult:"Tuloksia ei löytynyt",loading:"Ladataan hakuindeksiä..."},"/hu/":{cancel:"Mégse",placeholder:"Keresés",search:"Keresés",searching:"Keresés",defaultTitle:"Dokumentáció",select:"kiválasztáshoz",navigate:"navigáláshoz",autocomplete:"automatikus kiegészítés",exit:"kilépéshez",history:"Keresési előzmények",emptyHistory:"Üres keresési előzmények",emptyResult:"Nincs találat",loading:"A keresési indexek betöltése..."},"/id/":{cancel:"Batal",placeholder:"Cari sesuatu 🔎",search:"Cari",searching:"Sedang mencari",defaultTitle:"Dokumentasi",select:"pilih",navigate:"navigasi",autocomplete:"autoselesai",exit:"keluar",history:"Riwayat Penelusuran",emptyHistory:"Tidak ada riwayat penelusuran",emptyResult:"Hasil penelusuran tidak tersedia",loading:"Memuat indeks penelusuran..."},"/nl/":{cancel:"Annuleren",placeholder:"Zoeken",search:"Zoeken",searching:"Zoeken",defaultTitle:"Documentatie",select:"Selecteren",navigate:"to navigate",autocomplete:"autocompletion",exit:"to exit",history:"Zoekgeschiedenis",emptyHistory:"Zoekgeschiedenis Leegmaken",emptyResult:"Geen resultaten gevonden",loading:"Laden van zoekindexen..."}};let k=null;const T=async(e,a)=>{if(e.env.isDev){const i=await _(e,a);k=i,await Promise.all(S(i).map(([t,o])=>e.writeTemp(`search-pro/${x(t)}.js`,`export default ${JSON.stringify(JSON.stringify(o))};`))),await e.writeTemp("search-pro/index.js",`export default {${A(i).map(t=>`${JSON.stringify(t)}: () => import('./${x(t)}.js')`).join(",")}}`)}},q=async(e,a,i)=>{if(k){const t=i.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{pages:o,writeTemp:l}=e,n=o.find(({filePathRelative:s})=>(s==null?void 0:s.toLowerCase())===t.toLowerCase());if(n){const s=I(n,a.customFields,a.indexContent),{pathLocale:c,key:u}=n,h=k[c];if(s){Array.from(h._documentIds.values()).filter(p=>p.startsWith(u)).forEach(p=>L(h,p)),te(h,s),await D(h);const d=`export default ${JSON.stringify(JSON.stringify(h))}
`;await l(`search-pro/${x(c)}.js`,d);return}}}await T(e,a)},de=async(e,a,i)=>{if(k){const t=i.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{pages:o,writeTemp:l}=e,n=o.find(({filePathRelative:s})=>(s==null?void 0:s.toLowerCase())===t.toLowerCase());if(n){const{pathLocale:s,key:c}=n,u=k[s];Array.from(u._documentIds.values()).filter(d=>d.startsWith(c)).forEach(d=>L(u,d)),await D(u);const h=`export default ${JSON.stringify(JSON.stringify(u))}
`;await l(`search-pro/${x(s)}.js`,h);return}}await T(e,a)},pe=(e,a=!0)=>i=>(a&&ie(e),J(i,{id:"hope"}),Z(i,f,"2.0.0-beta.63"),i.env.isDebug&&P.info("Options:",e),{name:f,alias:{[`${f}/result`]:`${$}components/SearchResult.js`},define:{SEARCH_PRO_ENABLE_AUTO_SUGGESTIONS:e.autoSuggestions!==!1,SEARCH_PRO_CUSTOM_FIELDS:z((e.customFields||[]).map(({formatter:t},o)=>t?[o.toString(),t]:null).filter(t=>t!==null)),SEARCH_PRO_LOCALES:G({app:i,name:f,config:e.locales,default:ue}),SEARCH_PRO_OPTIONS:{searchDelay:e.searchDelay||150,suggestDelay:e.suggestDelay||0,queryHistoryCount:e.queryHistoryCount||5,resultHistoryCount:e.resultHistoryCount||5,hotKeys:e.hotKeys||[{key:"k",ctrl:!0},{key:"/",ctrl:!0}],worker:e.worker||"search-pro.worker.js"}},clientConfigFile:`${$}config.js`,extendsBundlerOptions:(t,o)=>{M(t,o,"slimsearch"),U(t,o,["fflate","vuepress-shared"])},onInitialized:t=>ne(t),onPrepared:t=>T(t,e),onWatched:(t,o)=>{if("hotReload"in e?e.hotReload:t.env.isDebug){const l=K("pages/**/*.vue",{cwd:t.dir.temp(),ignoreInitial:!0});l.on("add",n=>{q(t,e,n)}),l.on("change",n=>{q(t,e,n)}),l.on("unlink",n=>{de(t,e,n)}),o.push(l)}},onGenerated:t=>ce(t,e)});var F=(e=>(e.heading="h",e.anchor="a",e.text="t",e.customFields="c",e))(F||{});export{F as IndexField,pe as searchProPlugin};
//# sourceMappingURL=index.js.map
