---
title: 快手
icon: duihua
category:
  - 面经
tag:
  - 快手
  - 面经
---

⁉️ 个人回答不保证正确

## 一面

#### 自我介绍

#### 对电商项目的优化

- 更改了 JVM 中的老年代和新生代的内存分布，将秒杀的并发量提高。
- 使用 `CompletableFuture` 对 SKU 数据进行异步查询，提高了查询速度。
- 登录部分由原来的手动查询用户数据密码比对，改为了使用 `SpringSecurity` 进行登录认证，简化了开发步骤，另外使用 Redis 解决分布式下的用户数据共享。
- 使用 Sentinel 限制后端并发数，熔断降级保证服务安全可用。

### 虚拟内存的概念

- 虚拟内存是解决内存紧张的问题，对应于操作系统调度中的中级调度，在程序运行时并不要把所有的数据都放入内存，并且在内存紧张时将部分暂时不会执行的进程放入到磁盘中，等到内存够用时再将其调回内存。

### 操作系统中文件的实现

- 单级目录结构和多级目录结构以及图形目录结构的优缺点。

> 现在想起来面试官问的应该是文件的逻辑结构和物理结构。
>
> 逻辑结构分为顺序，索引和顺序索引结构。
>
> 物理结构的实现分为
>
> - 连续分配，在目录中设置对应文件的开始块号和结束块号。
>
> - 链接分配分为隐式链接和显式链接，隐式链接可靠性差，显示连接的指针占用空间，并且可靠性也不好。
> - 索引分配，为每个文件分配一个索引分配表，表中记录了属于这个文件的磁盘块，不仅支持随机访问，而且不会产生外部碎片。
> - 混合索引分配，既有直接地址分配，又有多级索引分配。

### 多级缓存的作用

- （这玩意书上怎么没看到），我说我对硬件有所了解，CPU 中的缓存就是多级缓存，现在的 CPU 一般包含三级缓存，分别是 l1，l2，l3，速度逐渐降低，容量逐渐扩大，使用多级缓存能很好的解决 CPU 速度和主存速度不匹配的问题，就像主存用来解决 CPU 和 磁盘之间的速度差异一样。

### 访问一个网址的过程

- 首先通过 DNS 解析为 IP 地址，再和 IP 地址进行 TCP 三次握手，将请求发送给服务器，服务器处理之后返回解析的数据，浏览器展示。

### TCP 三次握手说说

- 首先客户端发送数据到客户端，当中有 `SYN=1,seq=x`，服务器收到数据之后返回确认 `SYN=1,ack=x+1,seq=y`，客户端收到确认之后返回确认`ack=y+1,seq=x+1`。

### HTTP 和 HTTPS 的区别

- **端口号**：HTTP 默认是 `80`，HTTPS 默认是 `443`。

- **URL 前缀**：HTTP 的 URL 前缀是 `http://`，HTTPS 的 URL 前缀是 `https://`。

- **安全性和资源消耗**：HTTP 协议运行在 TCP 之上，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份。HTTPS 是运行在 SSL/TLS 之上的 HTTP 协议，SSL/TLS 运行在 TCP 之上。所有传输的内容都经过加密，加密采用对称加密，但对称加密的密钥用服务器方的证书进行了非对称加密。所以说，HTTP 安全性没有 HTTPS 高，但是 HTTPS 比 HTTP 耗费更多服务器资源。

### 常见的 Request Header

- `Accept`：请求报头域，用于指定客户端能接受哪些类型的信息。
- `Host`：用于指定请求资源的主机 IP 和端口号，其内容为请求 URL 的原始服务器或网关的地址。
- `Referer`：表示当前的请求是从哪个 URL 过来的，一般可以用来做反爬虫，不是本站发送的请求就不会响应。
- `Connection`：分为 `close` 和 `keep-alive` 用来表示发送完请求的对象之后是关闭连接还是持续的连接。
- `Access-Control-Allow-Origin`：允许跨域时添加的参数，用来表示哪个源地址发来的请求允许跨域。
- `Cache-Control`：控制是否能缓存数据。
- `Accept-Language`：浏览器支持的语言。
- `Accept-Encoding`：浏览器支持的编码方案。

### 数据库为什么比 Redis 慢？

- 数据库需要从磁盘中读取页来进行查询，而 Redis 是在内存中操作，所以速度更快，另外 Redis 使用多路复用技术使得并发量进一步提高。

### 如果一张表中有太多的列和太多的行，怎么进行优化？

- 水平分表和垂直分表，将数据分散到多张表中以解决单表的并发度问题。

### 算法题

- 链表右移，右移的元素放入到头部
- 例如 1->2->3->4，右移 1 次之后变成 4->1->2->3，求出右移 k 次之后的链表，秒了。 

### 反问技术栈

## 二面 挂

> 面出阴影了。

### 介绍一下线程池

- 介绍了线程池参数，拒绝策略，常见的线程池实现，任务队列的类型等。

### 在项目中如何通过场景的不同给定线程数目？

- 在 CPU 繁忙的项目中，将核心线程数设置为 N + 1，N 为 CPU 核心数，多出来的 1 用来处理偶然发生的缺页中断。
- IO 密集型设置核心线程数为 2N，系统大部分时间用来处理 IO 交互，处理 IO 的时候就不会占用 CPU 资源，这时可以将 CPU 交给其他任务。

> 面试管说在 IO 繁忙型的项目中，不应该设置这么多的核心线程，因为在 IO 的时候线程是会阻塞的，设置多个线程没有作用。

### 假如我是个小白，如何向我解释并发编程？

- 我觉得 Java 的主要优势就是多线程的并发执行，在并发执行的过程中，如果不加以限制就会导致结果出现错误（并行语义之间不保证顺序性），因此并发编程就是学习在各种业务场景下保证线程安全，并学习 JDK 中的各种并发安全的类。

### 说说 Java 当中的锁

- 互斥锁和共享锁算分类吗？
- **算的，举个例子。**
- 例如同步锁 synchronized 关键字就是互斥锁，另外还有基于 AQS 实现的 ReentrantLock、CountDownLatch、CyclicBarrier。
- **如果对实例方法加锁，锁住的是什么？**
- （这里不知道为啥就突然想不起来了）回答了是对方法加锁（错误），实际上是对实例对象进行加锁。如果是对静态方法加锁，则锁住的是类.class。

### 如果现在要一个线程安全的 List，你会如何实现？

- （想到了 CopyOnWriteArrayList）使用写时复制技术，也就是在读取的时候不会加锁，并且在读时写的时候也不会加锁，而是通过对原有数据复制一份进行修改，最后再覆盖原来的数据。

> 感觉面试官不太理解我说的话，头面向一边开始思考，然后说我记得 CopyOnWriteArrayList 写的时候会加锁的吧。（CopyOnWriteArrayList 在写和写之间会添加锁）

### 谈一下你对内部类的理解？

- （只想到了单例模式的静态内部类实现方法）单例模式的一种实现方式就是静态内部类，在静态内部类里面对单例类实例化，则在单例类被装载的时候并不会实例化静态内部类，只有在外部调用的时候才会进行实例化。
- 普通的内部类我觉得是体现了封装关系吧。（开始胡扯）

### 项目当中遇到的困难？

- 在秒杀的整体流程中考虑如何保证不会出现超卖和保证服务器正常运作，因此通过视频学习，实现了通过 Redis 给用户占位，Semaphore 模拟库存扣减，消息队列进行削峰减少服务器压力。通过 CompletableFuture 实现了 SKU 的异步查询，提高了接口的访问速度。
- 另外在后期的优化中，通过对 JVM 的学习，调整了堆内存的分布，提高了 QPS。

### 算法题：归并两个有序的数组 nums1，nums2，假设 nums1 有足够的空间

- 如果创建新的链表将另外两个链表归并能直接秒。在不创建额外的数组的条件下，代码写了一会，发现得不到想要的结果。面试完之后在本地 IDE 上调试了一下，发现有个点没考虑到。（真他妈蠢啊）
- **你的解题思路是什么？**
- 将 nums2 中的元素归并到 nums1 中，如果要插入 nums1 的 idx1 位置，则需要将这个位置以及后面的元素都向后移动移动一个位置。
- **时间复杂度为多少？**
- 如果两个数组的长度都看成 n，则时间复杂度为 n 平方，因为外层是对数组遍历，内层是移动元素。
- **时间复杂度的定义是啥？**
- 找到程序中平均运行次数最多的语句，计算他的运行次数，并得到相应的数量级就是时间复杂度。

### 反问技术栈（已经凉了，不知道问啥就跟一面问的相同）
